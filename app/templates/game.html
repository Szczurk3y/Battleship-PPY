{% extends "home_base.html" %}
{% block title %} Battleship {% endblock %}

{% block head %} 
    {{ super() }}
    <link rel="stylesheet" href="{{url_for("static", filename="style_game.css")}}" />
{% endblock %}
{% block content %}
    {{ super() }}
    <h1>Plansza przeciwnika</h1>

    <table id="bot-board">
        {% for y in range(10) %}
        <tr>
            {% for x in range(10) %}
            <td data-x="{{ x }}" data-y="{{ y }}"
                {% if (x, y) in shots %} class="clicked" {% endif %}></td>
            {% endfor %}
        </tr>
        {% endfor %}
    </table>

    <script>
        document.querySelectorAll("#bot-board td").forEach(cell => {
            cell.addEventListener("click", () => {
                if (cell.classList.contains("clicked")) return;

                const x = cell.dataset.x;
                const y = cell.dataset.y;

                fetch("/home/game/fire", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ x: x, y: y })
                })
                .then(res => res.json())
                .then(data => {
                    cell.classList.add("clicked");
                    if (data.hit) {
                        cell.classList.add("hit");
                    } else {
                        cell.classList.add("miss");
                    }
                });
            });
        });
    </script>

{% endblock %}